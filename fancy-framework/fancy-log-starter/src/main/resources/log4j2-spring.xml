<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN" monitorInterval="60">
    <!-- 公共属性 -->
    <Properties>
        <!-- 日志格式: 时间(带时区) 等级 线程ID TraceID 线程名 Logger名称 : 日志内容 -->
        <Property name="CONSOLE_PATTERN">
            %d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %highlight{%-5level} %style{${sys:PID}}{magenta} %notEmpty{[%X{traceId}]} --- [%15.15t] %style{%-40.40logger}{cyan} : %msg%n
        </Property>
        <Property name="FILE_PATTERN">
            %d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %-5level ${sys:PID} %notEmpty{[%X{traceId}]} --- [%15.15t] %-40.40logger : %msg%n
        </Property>
        <!-- 日志文件目录, 默认 logs -->
        <Property name="LOG_FILE_PATH">${logging.file.path:-logs}</Property>
        <!-- 应用名称, 默认 fancy-app -->
        <Property name="APP_NAME">${spring.application.name:-fancy-app}</Property>
        <!-- 根日志级别, 默认 info -->
        <Property name="LOG_LEVEL">${logging.level.root:-info}</Property>
    </Properties>

    <!-- 日志输出器 -->
    <Appenders>
        <!-- 控制台 -->
        <Console name="Console" target="SYSTEM_OUT">
            <!-- 允许颜色 -->
            <PatternLayout pattern="${CONSOLE_PATTERN}" disableAnsi="false"/>
        </Console>

        <!-- 滚动文件: 优先使用 logging.file.name 配置的路径, 否则等价用 日志目录/应用名称 -->
        <RollingFile name="RollingFile"
                     fileName="${logging.file.name:-${LOG_FILE_PATH}/${APP_NAME}.log}"
                     filePattern="${logging.file.name:-${LOG_FILE_PATH}/${APP_NAME}.log}.%d{yyyy-MM-dd}.%i.gz">
            <!-- 禁止颜色 -->
            <PatternLayout pattern="${FILE_PATTERN}" disableAnsi="true"/>
            <Policies>
                <!-- 每天新建日志文件 -->
                <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
                <!-- 每个文件最大 128MB 后滚动 -->
                <SizeBasedTriggeringPolicy size="128MB"/>
            </Policies>
            <!-- 最多保留 7 个历史文件 -->
            <DefaultRolloverStrategy max="7"/>
        </RollingFile>
    </Appenders>

    <!-- 日志记录器 -->
    <Loggers>
        <!-- 第三方框架日志降级处理 -->
        <Logger name="org.springframework" level="warn"/>

        <!--  默认日志输出 -->
        <Root level="${LOG_LEVEL}">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="RollingFile"/>
        </Root>
    </Loggers>

    <!-- 开发环境配置 -->
    <SpringProfile name="dev">
        <Loggers>
            <Root level="${LOG_LEVEL}">
                <AppenderRef ref="Console"/>
            </Root>
        </Loggers>
    </SpringProfile>

    <!-- 生产环境配置 -->
    <SpringProfile name="prod">
        <Loggers>
            <Root level="${LOG_LEVEL}">
                <AppenderRef ref="RollingFile"/>
            </Root>
        </Loggers>
    </SpringProfile>
</Configuration>
